---
- name: Install rabbitmq package on {{ ansible_distribution }}
  become: yes
  package:
    name: rabbitmq-server
    state: present
  notify:
    - restart rabbitmq
  tags: rabbitmq

- name: Ensure rabbitmq is enabled and running
  become: yes
  service:
    name: rabbitmq-server
    enabled: yes
    state: started
  tags: rabbitmq

- name: Add RabbitMQ plugins
  become: yes
  rabbitmq_plugin:
    name: "{{ item }}"
    state: enabled
  with_items: "{{ rmq_plugins }}"
  when: rmq_plugins
  tags: rabbitmq
